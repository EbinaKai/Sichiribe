# Pythonファイルのアプリ化について

私はプログラムをExe化、つまりアプリ化することを目指した。  

最初に、`Pyintallery` というライブラリを使用しよう考えた。しかしこれは、Pythonのファイルをただ、バンドル化しただけで、以下の欠点があった。

- 実行速度が遅い
- アプリサイズが肥大化する
- ウイルスアプリと認識される可能性がある

そのため、今回は `nuitka` というライブラリを用いることにした。  
このライブラリは、Pythonファイルを一度C言語でコンパイルし直すため、オーバーヘッドが少なく、実行速度が早いという特徴がある。唯一の欠点はビルドに時間がかかるというぐらいだ。

## PySide6 について

アプリを配布するにあたって、サイズを可能な限り小さくすることを試みた。  
サイズが大きいライブラリの一つが、GUI用のライブラリの `PySide6` だった。必要な機能だけを含む `PySide6_Essentials` に切り替えることで、サイズが約1/2になった。

```bash
pip uninstall PySide6
pip install PySide6_Essentials
```

## tflite-runtime について

アプリサイズの圧縮において一番の問題は `tensorflow` だった。ライブラリのフルサイズが1GBを超える。アプリ内では推論機能のみを用い、学習は行わないため、どうにか不要な機能を取り除きたい。  

まず、使用する学習済モデルを `.keras` から `.tflite` 形式に変換し、`tensorflow lite` を用いることで、モデルサイズを1/3ほどに圧縮できた。  
しかし、問題は推論機能のみが含まれる `tflite-runtime` は、エッジデバイス向けに linux 向けのビルドしか配布されていない。その他のプラットフォーム用には自分でビルドする必要があった。  
詳しい内容に方法については、 [about_tensorflow.md](./about_tensorflow.md) を参照してほしい。

## アプリのビルド

次にアプリのビルドに移る。ビルドする前に、プログラムが必要なすべての依存関係と学習済みモデルを認識し、実行可能かどうかを確認すること。  

Nuitkaを使ってビルドするには以下のライブラリが必要なのでインストールする。  

```bash
# ライブラリのインストール
pip install nuitka zstandard orderedset imageio

# ビルド
source script/build.sh
```

以上。
